/**
 * è®­ç»ƒä¼šè¯é¡µé¢ - Training Session
 * å®æ—¶è®°å½•è®­ç»ƒè¿‡ç¨‹ï¼Œæ”¯æŒè®¡æ—¶ã€åŠ¨ä½œç®¡ç†ã€ç»„è®°å½•ç­‰åŠŸèƒ½
 */

import {
  TrainingSessionModel,
  SessionExerciseModel,
  TrainingSetModel,
  TrainingDifficultyConst,
  SetTypeConst,
  toast,
  TrainingApiService,
  TrainingRecordModel,
  ExerciseModel,
  ActionModel,
  ActionDataService
} from '@tbs/common';
import { router } from '@kit.ArkUI';
import { promptAction } from '@kit.ArkUI';
import { ResponseResult } from '@tbs/common/src/main/ets/http/response';

/**
 * é€‰ä¸­åŠ¨ä½œæ•°æ®ç±»ï¼ˆä¸ ActionSelectPage å…±äº«ï¼‰
 */
class SelectedActionData {
  id: string = '';
  name: string = '';
  muscleGroup: string = '';
  thumbnailUrl: string = '';
}

@Entry
@Component
struct TrainingSessionPage {
  @State session: TrainingSessionModel = new TrainingSessionModel()
  @State currentTime: string = '00:00'
  @State timerInterval: number = -1
  @State pauseStartTime: number = 0
  @State showDifficultyPicker: boolean = false
  @State showNoteDialog: boolean = false
  @State tempNote: string = ''
  @State isSaving: boolean = false

  aboutToAppear(): void {
    this.session.startTime = Date.now();
    this.session.isRunning = true;
    this.session.title = 'è®­ç»ƒè®°å½•';
    this.startTimer();
  }

  /**
   * é¡µé¢æ˜¾ç¤ºæ—¶æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„åŠ¨ä½œ
   */
  onPageShow(): void {
    this.checkSelectedActions();
  }

  /**
   * æ£€æŸ¥å¹¶å¤„ç†é€‰ä¸­çš„åŠ¨ä½œ
   */
  checkSelectedActions(): void {
    const jsonStr: string | undefined = AppStorage.get<string>('selectedActionsJson');

    if (jsonStr !== undefined && jsonStr.length > 0) {
      try {
        const selectedData: SelectedActionData[] = JSON.parse(jsonStr) as SelectedActionData[];

        if (selectedData.length > 0) {
          let addedCount: number = 0;
          const newExercises: SessionExerciseModel[] = [];

          // å¤åˆ¶ç°æœ‰åŠ¨ä½œ
          for (let k: number = 0; k < this.session.exercises.length; k++) {
            newExercises.push(this.session.exercises[k]);
          }

          for (let i: number = 0; i < selectedData.length; i++) {
            const actionData: SelectedActionData = selectedData[i];
            const actionId: string = actionData.id;
            const actionName: string = actionData.name;
            const muscleGroup: string = actionData.muscleGroup;
            const thumbnailUrl: string = actionData.thumbnailUrl;

            // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ è¯¥åŠ¨ä½œ
            let alreadyExists: boolean = false;
            for (let j: number = 0; j < newExercises.length; j++) {
              if (newExercises[j].actionId === actionId) {
                alreadyExists = true;
                break;
              }
            }

            if (!alreadyExists) {
              const newExercise: SessionExerciseModel = new SessionExerciseModel(
                actionId,
                actionName,
                muscleGroup,
                [],
                0,
                4,
                8,
                '',
                thumbnailUrl
              );
              // æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„æ­£å¼ç»„
              newExercise.addSet(SetTypeConst.WORKING, 0, 8);
              newExercises.push(newExercise);
              addedCount++;
            }
          }

          // æ¸…é™¤ AppStorage ä¸­çš„æ•°æ®
          AppStorage.delete('selectedActionsJson');

          // é‡æ–°èµ‹å€¼ session è§¦å‘ UI æ›´æ–°
          if (addedCount > 0) {
            const updatedSession: TrainingSessionModel = new TrainingSessionModel(
              this.session.title,
              this.session.startTime,
              this.session.pausedTime,
              newExercises,
              this.session.difficulty,
              this.session.notes,
              this.session.isRunning,
              this.session.planId
            );
            this.session = updatedSession;
            toast('å·²æ·»åŠ  ' + addedCount.toString() + ' ä¸ªåŠ¨ä½œ');
          }
        }
      } catch (e) {
        console.error('è§£æé€‰ä¸­åŠ¨ä½œæ•°æ®å¤±è´¥');
      }
    }
  }

  aboutToDisappear(): void {
    this.stopTimer();
  }

  /**
   * å¯åŠ¨è®¡æ—¶å™¨
   */
  startTimer(): void {
    this.stopTimer();
    this.timerInterval = setInterval((): void => {
      this.updateTimer();
    }, 1000);
  }

  /**
   * åœæ­¢è®¡æ—¶å™¨
   */
  stopTimer(): void {
    if (this.timerInterval !== -1) {
      clearInterval(this.timerInterval);
      this.timerInterval = -1;
    }
  }

  /**
   * æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
   */
  updateTimer(): void {
    const seconds: number = this.session.getDurationInSeconds();
    const minutes: number = Math.floor(seconds / 60);
    const secs: number = seconds % 60;
    const minutesStr: string = minutes < 10 ? '0' + minutes.toString() : minutes.toString();
    const secsStr: string = secs < 10 ? '0' + secs.toString() : secs.toString();
    this.currentTime = minutesStr + ':' + secsStr;
  }

  /**
   * æš‚åœ/ç»§ç»­è®¡æ—¶
   */
  toggleTimer(): void {
    if (this.session.isRunning) {
      this.pauseStartTime = Date.now();
      this.session.isRunning = false;
      this.stopTimer();
    } else {
      if (this.pauseStartTime > 0) {
        this.session.pausedTime += Date.now() - this.pauseStartTime;
        this.pauseStartTime = 0;
      }
      this.session.isRunning = true;
      this.startTimer();
    }
  }

  /**
   * å®Œæˆè®­ç»ƒ
   */
  async finishTraining(): Promise<void> {
    if (this.session.exercises.length === 0) {
      toast('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªè®­ç»ƒåŠ¨ä½œ');
      return;
    }

    if (this.session.getTotalCompletedSets() === 0) {
      toast('è¯·è‡³å°‘å®Œæˆä¸€ç»„è®­ç»ƒ');
      return;
    }

    this.showFinishDialog();
  }

  /**
   * æ˜¾ç¤ºå®Œæˆç¡®è®¤å¯¹è¯æ¡†
   */
  showFinishDialog(): void {
    promptAction.showDialog({
      title: 'å®Œæˆè®­ç»ƒ',
      message: 'ç¡®å®šè¦ç»“æŸå¹¶ä¿å­˜æœ¬æ¬¡è®­ç»ƒå—ï¼Ÿ',
      buttons: [
        {
          text: 'å–æ¶ˆ',
          color: '#666666'
        },
        {
          text: 'ä¿å­˜',
          color: '#007AFF'
        }
      ]
    }).then((data: promptAction.ShowDialogSuccessResponse): void => {
      if (data.index === 1) {
        this.saveTraining();
      }
    }).catch((): void => {
      console.error('Dialog error');
    });
  }

  /**
   * ä¿å­˜è®­ç»ƒè®°å½•
   */
  async saveTraining(): Promise<void> {
    this.isSaving = true;
    this.stopTimer();

    try {
      const record: TrainingRecordModel = this.convertToTrainingRecord();
      const res: ResponseResult = await TrainingApiService.createTrainingRecord(record);

      if (res.code === 0) {
        toast('è®­ç»ƒè®°å½•ä¿å­˜æˆåŠŸ');
        router.back();
      } else {
        toast(res.message ?? 'ä¿å­˜å¤±è´¥');
        this.isSaving = false;
      }
    } catch (err) {
      console.error('ä¿å­˜è®­ç»ƒè®°å½•å¤±è´¥:', JSON.stringify(err));
      toast('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
      this.isSaving = false;
    }
  }

  /**
   * è½¬æ¢ä¸ºè®­ç»ƒè®°å½•æ¨¡å‹
   */
  convertToTrainingRecord(): TrainingRecordModel {
    const record: TrainingRecordModel = new TrainingRecordModel();
    record.title = this.session.title;

    const now: Date = new Date();
    const year: number = now.getFullYear();
    const month: number = now.getMonth() + 1;
    const day: number = now.getDate();
    const hours: number = now.getHours();
    const minutes: number = now.getMinutes();

    record.date = year.toString() + '-' +
      (month < 10 ? '0' : '') + month.toString() + '-' +
      (day < 10 ? '0' : '') + day.toString();

    const startDate: Date = new Date(this.session.startTime);
    const startHours: number = startDate.getHours();
    const startMinutes: number = startDate.getMinutes();
    record.startTime = (startHours < 10 ? '0' : '') + startHours.toString() + ':' +
      (startMinutes < 10 ? '0' : '') + startMinutes.toString();

    record.endTime = (hours < 10 ? '0' : '') + hours.toString() + ':' +
      (minutes < 10 ? '0' : '') + minutes.toString();

    record.duration = this.session.getDuration();
    record.notes = this.session.notes;
    record.mood = this.session.difficulty;
    record.planId = this.session.planId;

    const exercises: ExerciseModel[] = [];
    for (let i: number = 0; i < this.session.exercises.length; i++) {
      const sessionEx: SessionExerciseModel = this.session.exercises[i];
      const completedSets: number = sessionEx.getCompletedSetsCount();

      if (completedSets > 0) {
        let totalReps: number = 0;
        let totalWeight: number = 0;

        for (let j: number = 0; j < sessionEx.sets.length; j++) {
          const set: TrainingSetModel = sessionEx.sets[j];
          if (set.isCompleted) {
            totalReps += set.reps;
            totalWeight += set.weight;
          }
        }

        const avgReps: number = Math.floor(totalReps / completedSets);
        const avgWeight: number = Math.floor(totalWeight / completedSets);

        const exercise: ExerciseModel = new ExerciseModel(
          0,
          sessionEx.actionName,
          completedSets,
          avgReps,
          avgWeight,
          0,
          sessionEx.muscleGroup,
          sessionEx.note,
          0
        );
        exercises.push(exercise);
      }
    }

    record.exercises = exercises;
    record.totalSets = this.session.getTotalCompletedSets();
    record.totalWeight = this.session.getTotalVolume();
    record.caloriesBurned = Math.floor(record.totalWeight * 0.1);

    return record;
  }

  /**
   * æ·»åŠ åŠ¨ä½œ
   */
  addExercise(): void {
    router.pushUrl({
      url: 'pages/ActionSelectPage'
    }).catch((err: Error): void => {
      console.error('è·³è½¬å¤±è´¥:', JSON.stringify(err));
    });
  }

  /**
   * åˆ é™¤åŠ¨ä½œ
   */
  removeExercise(index: number): void {
    promptAction.showDialog({
      title: 'åˆ é™¤åŠ¨ä½œ',
      message: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåŠ¨ä½œå—ï¼Ÿ',
      buttons: [
        {
          text: 'å–æ¶ˆ',
          color: '#666666'
        },
        {
          text: 'åˆ é™¤',
          color: '#FF0000'
        }
      ]
    }).then((data: promptAction.ShowDialogSuccessResponse): void => {
      if (data.index === 1) {
        this.session.removeExercise(index);
      }
    }).catch((): void => {
      console.error('Dialog error');
    });
  }

  /**
   * æ·»åŠ è®­ç»ƒç»„
   */
  addSet(exerciseIndex: number): void {
    const exercise: SessionExerciseModel = this.session.exercises[exerciseIndex];
    const lastSet: TrainingSetModel | null = exercise.sets.length > 0 ?
      exercise.sets[exercise.sets.length - 1] : null;

    const weight: number = lastSet !== null ? lastSet.weight : 0;
    const reps: number = lastSet !== null ? lastSet.reps : exercise.targetReps;

    exercise.addSet(SetTypeConst.WORKING, weight, reps);
  }

  /**
   * åˆ é™¤è®­ç»ƒç»„
   */
  removeSet(exerciseIndex: number, setIndex: number): void {
    this.session.exercises[exerciseIndex].removeSet(setIndex);
  }

  /**
   * åˆ‡æ¢ç»„å®ŒæˆçŠ¶æ€
   */
  toggleSetComplete(exerciseIndex: number, setIndex: number): void {
    const set: TrainingSetModel = this.session.exercises[exerciseIndex].sets[setIndex];
    set.isCompleted = !set.isCompleted;
  }

  /**
   * æ˜¾ç¤ºä¸»è§‚åé¦ˆé€‰æ‹©å™¨
   */
  selectDifficulty(difficulty: string): void {
    this.session.difficulty = difficulty;
  }

  /**
   * æ˜¾ç¤ºå¿ƒå¾—è¾“å…¥å¯¹è¯æ¡†
   */
  showNoteInput(): void {
    this.tempNote = this.session.notes;
    this.showNoteDialog = true;
  }

  /**
   * ä¿å­˜å¿ƒå¾—
   */
  saveNote(): void {
    this.session.notes = this.tempNote;
    this.showNoteDialog = false;
    toast('å¿ƒå¾—å·²ä¿å­˜');
  }

  build() {
    Stack({ alignContent: Alignment.Bottom }) {
      Column() {
        this.TopBar()

        Scroll() {
          Column({ space: 16 }) {
            if (this.session.exercises.length === 0) {
              this.EmptyState()
            } else {
              ForEach(this.session.exercises, (exercise: SessionExerciseModel, index: number) => {
                this.ExerciseCard(exercise, index)
              })
            }

            this.FeedbackSection()

            Column().height(100)
          }
          .width('100%')
          .padding(16)
        }
        .layoutWeight(1)
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F5F5F5')

      this.BottomBar()

      if (this.showNoteDialog) {
        this.NoteDialog()
      }
    }
    .width('100%')
    .height('100%')
    .expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])
  }

  @Builder
  TopBar() {
    Column({ space: 8 }) {
      // çŠ¶æ€æ å ä½
      Column()
        .height(0)
      
      Row() {
        Text('âœ–')
          .fontSize(20)
          .fontColor('#333333')
          .onClick((): void => {
            router.back();
          })

        TextInput({ text: this.session.title })
          .layoutWeight(1)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .backgroundColor(Color.Transparent)
          .margin({ left: 12, right: 12 })
          .onChange((value: string): void => {
            this.session.title = value;
          })

        Button('âœ… å®Œæˆ')
          .fontSize(14)
          .height(32)
          .backgroundColor('#4CAF50')
          .borderRadius(6)
          .onClick((): void => {
            this.finishTraining();
          })
      }
      .width('100%')
      .height(50)
      .padding({ left: 16, right: 16 })

      Row() {
        Row({ space: 8 }) {
          Text(this.currentTime)
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .fontColor('#007AFF')

          Text(this.session.isRunning ? 'â¸' : 'â–¶')
            .fontSize(18)
            .onClick((): void => {
              this.toggleTimer();
            })
        }

        Text(this.session.getTotalCompletedSets().toString() + '/' +
          this.session.exercises.length.toString() + 'ç»„  ' +
          this.session.getCompletedExercisesCount().toString() + '/' +
          this.session.exercises.length.toString() + 'åŠ¨ä½œ  ' +
          this.session.getTotalVolume().toString() + 'kgå®¹é‡')
          .fontSize(12)
          .fontColor('#666666')
      }
      .width('100%')
      .padding({ left: 16, right: 16 })
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .width('100%')
    .backgroundColor(Color.White)
    .padding({ top: 15, bottom: 12 })
  }

  @Builder
  EmptyState() {
    Column({ space: 16 }) {
      Text('ğŸ‹ï¸')
        .fontSize(48)

      Text('è¿˜æ²¡æœ‰æ·»åŠ è®­ç»ƒåŠ¨ä½œ')
        .fontSize(16)
        .fontColor('#666666')

      Text('ç‚¹å‡»ä¸‹æ–¹ã€Œâ• åŠ åŠ¨ä½œã€å¼€å§‹è®­ç»ƒ')
        .fontSize(14)
        .fontColor('#999999')
    }
    .width('100%')
    .margin({ top: 80 })
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }

  @Builder
  ExerciseCard(exercise: SessionExerciseModel, exerciseIndex: number) {
    Column({ space: 12 }) {
      Row() {
        Column({ space: 4 }) {
          Text(exercise.actionName)
            .fontSize(17)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')

          Text(exercise.muscleGroup)
            .fontSize(12)
            .fontColor('#999999')
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)

        Row({ space: 12 }) {
          Text('âš™')
            .fontSize(16)

          Text('âœ–')
            .fontSize(16)
            .fontColor('#FF4444')
            .onClick((): void => {
              this.removeExercise(exerciseIndex);
            })
        }
      }
      .width('100%')

      Divider().color('#F0F0F0')

      Column({ space: 0 }) {
        Row() {
          Text('ç»„')
            .fontSize(12)
            .fontColor('#666666')
            .width(40)
            .textAlign(TextAlign.Center)

          Text('ç±»å‹')
            .fontSize(12)
            .fontColor('#666666')
            .width(60)
            .textAlign(TextAlign.Center)

          Text('é‡é‡(kg)')
            .fontSize(12)
            .fontColor('#666666')
            .width(80)
            .textAlign(TextAlign.Center)

          Text('æ¬¡æ•°')
            .fontSize(12)
            .fontColor('#666666')
            .width(60)
            .textAlign(TextAlign.Center)

          Text('âœ“')
            .fontSize(12)
            .fontColor('#666666')
            .width(40)
            .textAlign(TextAlign.Center)

          Text('...')
            .fontSize(12)
            .fontColor('#666666')
            .width(40)
            .textAlign(TextAlign.Center)
        }
        .width('100%')
        .height(32)
        .backgroundColor('#F8F8F8')
        .borderRadius(6)

        ForEach(exercise.sets, (set: TrainingSetModel, setIndex: number) => {
          this.SetRow(set, exerciseIndex, setIndex)
        })
      }
      .width('100%')

      Button('+ æ·»åŠ ç»„')
        .width('100%')
        .height(36)
        .fontSize(14)
        .backgroundColor('#F0F0F0')
        .fontColor('#007AFF')
        .borderRadius(6)
        .onClick((): void => {
          this.addSet(exerciseIndex);
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .alignItems(HorizontalAlign.Start)
  }

  @Builder
  SetRow(set: TrainingSetModel, exerciseIndex: number, setIndex: number) {
    Row() {
      Text((setIndex + 1).toString())
        .fontSize(14)
        .fontColor('#333333')
        .width(40)
        .textAlign(TextAlign.Center)

      Text(set.setType)
        .fontSize(12)
        .fontColor(set.setType === SetTypeConst.WARMUP ? '#FF9800' :
          set.setType === SetTypeConst.COOLDOWN ? '#4CAF50' : '#2196F3')
        .width(60)
        .textAlign(TextAlign.Center)
        .backgroundColor(set.setType === SetTypeConst.WARMUP ? '#FFF3E0' :
          set.setType === SetTypeConst.COOLDOWN ? '#E8F5E9' : '#E3F2FD')
        .borderRadius(4)
        .padding({ top: 2, bottom: 2 })

      TextInput({ text: set.weight.toString() })
        .width(80)
        .height(32)
        .fontSize(14)
        .type(InputType.Number)
        .textAlign(TextAlign.Center)
        .backgroundColor('#F8F8F8')
        .borderRadius(4)
        .onChange((value: string): void => {
          const weight: number = parseInt(value, 10);
          if (!isNaN(weight)) {
            set.weight = weight;
          }
        })

      TextInput({ text: set.reps.toString() })
        .width(60)
        .height(32)
        .fontSize(14)
        .type(InputType.Number)
        .textAlign(TextAlign.Center)
        .backgroundColor('#F8F8F8')
        .borderRadius(4)
        .onChange((value: string): void => {
          const reps: number = parseInt(value, 10);
          if (!isNaN(reps)) {
            set.reps = reps;
          }
        })

      Text(set.isCompleted ? 'âœ…' : 'â­•')
        .fontSize(18)
        .width(40)
        .textAlign(TextAlign.Center)
        .onClick((): void => {
          this.toggleSetComplete(exerciseIndex, setIndex);
        })

      Text('âœ–')
        .fontSize(14)
        .fontColor('#FF4444')
        .width(40)
        .textAlign(TextAlign.Center)
        .onClick((): void => {
          this.removeSet(exerciseIndex, setIndex);
        })
    }
    .width('100%')
    .height(44)
    .padding({ top: 6, bottom: 6 })
  }

  @Builder
  FeedbackSection() {
    Column({ space: 12 }) {
      Text('è®­ç»ƒæ„Ÿå—')
        .fontSize(14)
        .fontWeight(FontWeight.Medium)
        .fontColor('#333333')
        .width('100%')

      Row({ space: 12 }) {
        this.DifficultyButton('ç®€å•', 'ğŸŸ¢')
        this.DifficultyButton('æ­£å¸¸', 'ğŸŸ¡')
        this.DifficultyButton('å›°éš¾', 'ğŸ”´')
      }
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .alignItems(HorizontalAlign.Start)
  }

  @Builder
  DifficultyButton(difficulty: string, icon: string) {
    Button() {
      Row({ space: 6 }) {
        Text(icon)
          .fontSize(16)

        Text(difficulty)
          .fontSize(14)
          .fontColor(this.session.difficulty === difficulty ? Color.White : '#333333')
      }
    }
    .layoutWeight(1)
    .height(40)
    .backgroundColor(this.session.difficulty === difficulty ? '#007AFF' : '#F0F0F0')
    .borderRadius(8)
    .onClick((): void => {
      this.selectDifficulty(difficulty);
    })
  }

  @Builder
  BottomBar() {
    Row({ space: 12 }) {
      Button('æœ€å°åŒ–')
        .fontSize(14)
        .height(44)
        .layoutWeight(1)
        .backgroundColor('#E0E0E0')
        .fontColor('#333333')
        .borderRadius(8)
        .onClick((): void => {
          toast('æœ€å°åŒ–åŠŸèƒ½å¼€å‘ä¸­...');
        })

      Button('â• åŠ åŠ¨ä½œ')
        .fontSize(14)
        .height(44)
        .layoutWeight(1)
        .backgroundColor('#007AFF')
        .borderRadius(8)
        .onClick((): void => {
          this.addExercise();
        })

      Button('âœï¸ å†™å¿ƒå¾—')
        .fontSize(14)
        .height(44)
        .layoutWeight(1)
        .backgroundColor('#4CAF50')
        .borderRadius(8)
        .onClick((): void => {
          this.showNoteInput();
        })

      Button('âš™ï¸')
        .fontSize(16)
        .width(44)
        .height(44)
        .backgroundColor('#9E9E9E')
        .borderRadius(8)
        .onClick((): void => {
          toast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
  }

  @Builder
  NoteDialog() {
    Column() {
      Column({ space: 0 }) {
        Text('è®­ç»ƒå¿ƒå¾—')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .width('100%')
          .textAlign(TextAlign.Center)
          .padding(16)

        TextArea({ text: this.tempNote })
          .width('100%')
          .height(200)
          .fontSize(14)
          .backgroundColor(Color.White)
          .onChange((value: string): void => {
            this.tempNote = value;
          })

        Row({ space: 12 }) {
          Button('å–æ¶ˆ')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#E0E0E0')
            .fontColor('#333333')
            .onClick((): void => {
              this.showNoteDialog = false;
            })

          Button('ä¿å­˜')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#007AFF')
            .onClick((): void => {
              this.saveNote();
            })
        }
        .width('100%')
        .padding(16)
      }
      .width('90%')
      .backgroundColor(Color.White)
      .borderRadius(12)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('rgba(0, 0, 0, 0.5)')
    .justifyContent(FlexAlign.Center)
    .onClick((): void => {
      this.showNoteDialog = false;
    })
  }
}
